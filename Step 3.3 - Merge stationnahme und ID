# Load required library
library(readxl)
library(openxlsx)

# Read Excel file
file1 <- read_excel("file1.xlsx")

# Select only columns A (station_id) and G (Stationsname)
file1_selected <- file1[, c("Stations_id", "Stationsname")]

# If station_id is not already numeric or factor, convert it to numeric
if (!is.numeric(file1_selected$Stations_id) && !is.factor(file1_selected$Stations_id)) {
  file1_selected$Stations_id <- as.numeric(file1_selected$Stations_id)
}

# Rename the columns to match the desired output
colnames(file1_selected) <- c("Stations_id", "Stationsname")
head(file1_selected)


# Read the first two rows from file2.csv
file2 <- read.csv("file2.csv", header = FALSE)
head(file2)

# Transpose the dataframe
file2_transposed <- t(file2)

# Convert to a dataframe
file2_transposed <- as.data.frame(file2_transposed)
head(file2_transposed)

# Set the first row as column names
colnames(file2_transposed) <- file2_transposed[1, ]

# Remove the first row
file2_transposed <- file2_transposed[-1, ]
head(file2_transposed)

# If station_id is not already numeric or factor, convert it to numeric
if (!is.numeric(file2_transposed$date) && !is.factor(file2_transposed$date)) {
  file2_transposed$date <- as.numeric(file2_transposed$date)
}



# Merge based on station_id and date 
merged_data <- merge(file2_transposed, file1_selected , by.x = "date", by.y = "Stations_id", all.x = TRUE, all.y = FALSE)
head(merged_data)

# Copy values from Stationsname.y to Stationsname.x
merged_data$Stationsname.x <- merged_data$Stationsname.y

# Drop the 'Stationsname.y' and 'Stations_id' column from file2_transposed in merged data
merged_data <- merged_data[, !(names(merged_data) %in% "Stationsname.y")]
merged_data <- merged_data[, !(names(merged_data) %in% "Stations_id")]

# Rename columns in merged data
names(merged_data)[which(names(merged_data) == "Stationsname.x")] <- "Stationsname"
names(merged_data)[which(names(merged_data) == "date")] <- "Stations_id"



# Create a data frame with the result
result <- data.frame(merged_data)
head(result)

# Sort the modified data by the Stations_id column
sorted_data <- result[order(result$Stations_id), ]
sorted_data <- as.data.frame(sorted_data)
head(sorted_data)

# Transpose the sorted data
transposed_data <- t(sorted_data)
fin_data <- as.data.frame(transposed_data)

# Remove 'x' character from row names
rownames(fin_data) <- gsub("X", "", rownames(fin_data))


head(fin_data)


# Save the modified data as CSV
write.csv(fin_data, file = "file2_upd.csv", row.names = TRUE)
